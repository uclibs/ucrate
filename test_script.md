# Scholar@UC Test Script

### Seed the database
* `bundle exec rake db:seed`

### Test user List (generated by the rake task above)
* Many Deposits (manydeposits@example.com)
* No Deposits (nodeposits@example.com)
* Student Delegate (delegate@example.com)
* Admin User (admin@example.com)

## Section 1

### First log in and welcome
1. Create a local account for yourself using your real email address that you can check
1. Log in as yourself
1. Verify that you see the welcome page after logging in
1. Verify that you receive a welcome email (may not work if you are running the application on your local machine)
1. Log out
1. Log in as yourself
1. Verify that you again see the welcome page
1. Click the `Edit my Profile` button at the bottom of the welcome page
1. Enter your first and last name
1. Click the `Save Profile` button
1. Log out
1. Log in as yourself
1. Verify that you see the welcome page with a `Click here to hide this welcome page` button
1. Click the `Click here to hide this welcome page` button
1. Log out
1. Log in as yourself
1. Verify that you see the "What are you uploading?" page (not the welcome page)

## Section 2

### Create works
1. Log in as yourself
1. Begin creating a new Generic Work
1. Verify the form has tabs at the top of the page
    * Metadata
    * DOI
    * Files
    * Relationships
    * Sharing
1. Verify that the visibility pane defaults to "Open Access" visibility
1. Verify that the visibility pane does *not* have a "Lease" option
1. Verify that your name (Lastname, Firstname) is auto-populated in the Creator field
1. Verify that some fields are required:
    * Title
    * Creator
    * College
    * Program or Department
    * Description
    * License
1. Verify that some fields are multi-valued:
    * Creator
    * Publisher
    * Alternate Title
    * Subject
    * Geographic Subject
    * Time Period
    * Language
    * External Link
1. DOIs
    1. Click on the `DOI` tab
    1. Select the radio button that you already have a DOI 
    1. Click on the `Metadata` tab
    1. Verify that "University of Cincinnati" is displayed in the Publisher field
    1. Click on the `DOI` tab
    1. Select the radio button that you don't want to create a DOI
    1. Click on the `Metadata` tab
    1. Verify that the Publisher field is empty
    1. Click on the `DOI` tab
    1. Select the radio button to create a new DOI
    1. Click on the `Metadata` tab
    1. Verify that "University of Cincinnati" is displayed in the Publisher field
1. Use the License Wizard to select a license
1. Enter multiple lines of content into the Description and Notes fields
1. Enter content into all of the remaining fields on the form
1. Save the work
1. Verify that the work saves without requiring files to be attached
1. Files
    1. Edit the work
    1. Attach a PDF, and Word document, and an image to the work 
    1. Save the work
    1. Verify that the files are attached and have proper thumbnails
        * Note: Thumbnails for Word documents require that LibreOffice is installed on the server
    1. Edit the work
    1. Attach a cloud file from Box.com (may not work if you are running the application on your local machine)
    1. Save the work
    1. Verify that the cloud file is attached
    1. Optional: Attempt to attach a file > 3 gigabytes in size and verify it is blocked
    1. Change the PDF and the image to `private` visibility
    1. Verify that the PDF and image are marked `private` and can only be seen when you are logged in as yourself
    1. Change the work visibility to `University of Cincinnati` and allow the system to update the visibility of all files
    1. Verify that the work and all files have `institution` visibility and can only be seen by logged-in users

### Add and delete files to works
1. On the Generic Work's show page, click the `Edit` button
1. Upload another file
1. Save the work
1. Delete the first file from the work
1. Verify that the file is removed

### Add child work to parent work
1. Creates a child work (you can use the work already in the script as the parent)
1. Adds the child work to a collection
1. Visit the child work's show page and verify that In Collections and In Parent Work are displaying properly.

### View works
1. View the Generic Work's show page
1. Verify that the license being displayed is the same one you chose with the wizard
1. Verify that line breaks are preserved for the Description and Notes fields
1. Verify that the appropriate metadata fields and labels are being displayed
1. Verify that the appropriate buttons are being displayed (Analytics, Edit, Delete, File Manager, Attach Child, Add to collection, etc.)
1. Verify that a DOI is displayed
1. Verify that the citation buttons do *not* display
1. Verify that the bottom of the page displays "Permanent link to this page:" followed by the work's hyperlink
1. Click on the attached PDF file to view its show page
1. Verify there is a link on the page to download Adobe Reader 
1. Verify that the bottom of the file page displays "Permanent link to this page:" followed by the file's hyperlink
1. Use the File Manager to change the order of files and select the image file as the representative for the work
1. Verify the image displays in the image viewer

### Delete works
1. Delete the work
1. Verify that the work and attached files can no longer be found

## Section 3

### Batch Create
1. Log in as yourself
1. Begin creating a new batch of Generic Works
1. Verify the form has tabs at the top of the page
    * Files
    * Metadata
    * Relationships
    * Sharing
1. Verify that the visibility pane defaults to "Open Access" visibility
1. Verify that the visibility pane does *not* have a "Lease" option
1. Add a few files
1. Click on the `Metadata` tab
1. Verify that your name (Firstname, Lastname) is auto-populated in the Creator field
1. Verify that some fields are required:
    * Creator
    * College
    * Program or Department
    * Description
    * License
1. Verify that some fields are multi-valued:
    * Creator
    * Publisher
    * Alternate Title
    * Subject
    * Geographic Subject
    * Time Period
    * Language
    * External Link
1. Enter content into all of the remaining fields on the form
1. Save the work
1. Verify that a unique work is created for each of the files added
1. Verify each of the works has the metadata you added

### Batch Edit
1. Visit `/Dashboard`
1. Click on `Works`
1. Select a few of your works and click the `Edit Selected` button
1. Verify that the Batch Edit page lists only multi-valued fields
1. Edit each of the fields
1. Save changes
1. Verify that each work retains the edits you made

## Section 4

### Create collections
1. Log in as an Admin User
1. Create a new collection type named "Test"
1. Log in as Many Deposits
1. Begin creating a new collection of type "Test" 
1. Describe the collection using every metadata field
1. Save the collection
1. Set the collection to `private` visibility and save it
1. Verify that the collection can only be seen when you are logged in as yourself
1. Add branding (a banner) to the collection and save it
1. Add at least ten works to the collection
1. Change the collection visibility to `public` and verify in can be seen by non-logged in users

### Create Subcollections
1. Visit `/dashboard`
1. Click on `Collections`
1. Click on one of your existing collections
1. Click the `Add new collection to this Collection` link
1. Fill out all of the metadata fields and save the collection
1. Visit the public view of the parent collection
1. Verify that the subcollection is listed on the collection's page

### View collections
1. View the collection's show page
1. Verify that the appropriate metadata fields and labels are being displayed
1. Verify that the banner is being displayed
1. Verify all of the collection's works are listed

### Delete collections
1. Remove some works from the collection
1. Verify that the works are no longer listed in the collection
1. Delete the collection
1. Verify that the collection can no longer be found

## Section 5

### Proxies
1. Log in as Many Deposits
1. Add Student Delegate as your proxy
1. Verify Student Delegate shows as a current proxy on your dashboard
1. Log in as Student Delegate
1. Begin creating a new Article work
1. Verify that "Delegate, Student" shows in the Author field
1. Verify that the College and Department fields contain the Student Delegate's College and Department
1. Change `On behalf of` to your own account
1. Verify that the Author field changes to "Deposits, Many"
1. Verify that the College and Department fields change to Many Deposit's College and Department
1. Fill out the required fields and save the work
1. Click the `Edit` button for the Article work
1. Verify on the edit form that the `On behalf of` dropdown is not displayed
1. Log in as Many Deposits
1. Verify that the Article work shows on the works dashboard
1. verify that the Article work can be edited by Many Deposits
1. Remove Student Delegate as your proxy
1. Log in as Student Delegate
1. Verify that the Article work no longer shows in the works dashboard
1. Verify that the Article work can no longer be edited by Student Delegate

### Collaborate on a work
1. Log in as Many Deposits
1. Create a private Student Work with many files attached
1. Verify that the Advisor field is required on Student Works
1. Add No Deposits as an editor
1. Log in as No Deposits
1. Navigate to the Student Work you created
1. Verify that you have edit access to the work
1. Edit some metadata and save the work
1. Remove an existing file from the work and add a new one
1. Add the work to a collection

### Profile Curation
1. Log in as Many Deposits
1. Edit the profile for Many Deposits and fill out all fields
1. Verify that the `Department`, `UC affiliation`, and `Email` fields cannot be edited
1. Save your changes
1. Verify all fields display on your profile page
1. Edit the profile and add a profile picture
1. Save your changes
1. Verify that the image is displayed on the profile page
1. Highlight one of your works
1. Verify the highlighted work displays on your profile page
1. Remove the highlighted work from your profile

### People Page
1. Visit `/users`
1. Verify that Many Deposits is listed on the page
1. Verify that No Deposits is not listed on the page
1. Verify that the correct college and department is listed for users
1. Verify that the correct number of works created is listed for users
1. Verify that Many Deposits has an avatar displayed
1. Use the search box on the page to find "many"
1. Verify that Many Deposits is found and listed
1. Log in as an admin
1. Visit `/users`
1. Verify that you can see all users listed

## Section 6

### Visibility
1. Log in as yourself
1. Create a Document work with a visibility of "University of Cincinnati"
1. Create an Image work with a visibility of "Open Access"
1. Log in as Many Deposits
1. Create a Dataset work with a visibility of "Private"
1. Visit `/catalog`
1. Verify that the Document, Image, and Dataset works show in the search results
1. Log out
1. Visit `/catalog`
1. Verify that only the Image work shows in the search results
1. Log in as Many Deposits
1. Visit `/catalog`
1. Verify that the Document, Image, and Dataset works show in the search results
1. Log in as yourself
1. Visit `/catalog`
1. Verify that the Document and Image works show in the search results

### Search and Discovery
1. Log in as Many Deposits
1. Visit `/catalog`
1. Verify that collections sort to the top of the search results list by default
1. Verify that works in the search results list show the following fields
    * Type
    * Description/Abstract
    * Creator/Author
    * Submitter
    * Date Uploaded
    * Date Modified
    * Date Created
    * License
1. Sort the results by `title A-Z`
1. Verify that the search results are sorted by title
1. Sort the results by `title Z-A`
1. Verify that the search results are sorted reverse by title
1. Verify that all facets display
    * Type of Work
    * Creator/Author
    * Subject
    * College
    * Department (displays only after the `College` facet has been selected)
    * Language
    * Publisher
    * Date Created
    * Collections
1. Search for the title of the Document work
1. Verify that the Document work shows in the search results
1. Select one of the facets
1. Verify that selecting a facet doesn't cause the original search to be lost

### Content feeds
1. Visit `/feed.rss`
1. Verify that the RSS feed displays the most recently added 10 works
1. Visit `/sitemap.xml`
1. Verify that the sitemap is displayed and includes works and collections

## Section 7

### Virus Scanning
1. Log in as yourself
1. Begin creating a new Generic Work
1. Click on the `Files` tab
1. Add several files and have one of them be an EICAR test virus file
1. Verify that the infected file is identified (may not work if you are running the application on your local machine)
1. Click on the `Metadata` tab
1. Fill out the required metadata
1. Save the work
1. Verify that all files except the infected file are attached

### Language Translation
1. Verify that the interface can be switched to Spanish or Chinese
1. Verify that the interface can be switched back to English

### Contact Form
1. Log in as yourself
1. Visit `/contact`
1. Verify that your name and email address are auto-populated on the form
1. Verify the form does *not* display a Google CAPTCHA
1. Fill out the form and submit
1. Verify the email is received by scholar@uc.edu recipients
1. Log out
1. Visit `/contact`
1. Verify that none of the fields are auto-populated
1. Verify the form does display a Google CAPTCHA (may not work if you are running the application on your local machine)
1. Fill out the form and submit
1. Verify the email is received by scholar@uc.edu recipients

## Section 8

### ETDs
1. Log in as yourself
1. Visit `/classify_concerns/new`
1. Verify that "ETD" is not one of the types of work available
1. Log in as admin user
1. Visit `/classify_concerns/new`
1. Begin creating a new ETD Work
1. Verify that the Creator field is *not* auto-populated
1. Verify that Advisor is a required field
1. Verify that Publisher is not a multi-valued field
1. Verify that the Degree and Degree Date fields exist
1. Fill out the required metadata fields
1. Save the work

### Embargoes
1. Log in as yourself
1. Create a Media Work with several files and an embargo date for tomorrow
1. Next day: Verify you received an email overnight that your work is now available
1. Next day: Verify that the work and attached files are now "Open Access"
